document.addEventListener('deviceready', onDeviceReady, false);

function onDeviceReady() {
    // Cordova is now initialized. Have fun!
    // isBtConnected();
}

// local storage
var localStorage = window.localStorage;

var dot = document.getElementById('dot');
var isBtDeviceConnected = false;

function isBtConnected() {
    setInterval(function () {
        //this code runs every second
        bluetoothSerial.isConnected(isBtConnectedSuccess, isBtConnectedFailure);
    }, 1000);

}

function isBtConnectedSuccess() {
    dot.style.backgroundColor = "#1cff00 ";
    isBtDeviceConnected = true;
    // console.log("[btEasy]", "Device is definitly Connected succesfull");
    return true;
}

function isBtConnectedFailure() {
    dot.style.backgroundColor = "red";
    isBtDeviceConnected = false;
    // console.log("[btEasy]","device not connected!!");
    return false;
}

function sendColorToBT() {
    bluetoothSerial.isConnected(function () {
        //colorString is format of:
        //['{"red":RED,"green":GREEN,"blue":BLUE,"mode":"solid",}]'
        //can be generated by myOwnTypeOfStringify()
        if (localStorage !== null && localStorage.getItem("rgbStringToSend")) {
            var colorString = localStorage.getItem("rgbStringToSend");
            console.log("[btEasy]", colorString);
            bluetoothSerial.write(colorString, sendSuccess, sendFailure);
        } else {
            dialogAlert("Failed to send info to BT device!\nTry and setting colors again.");
            sendFailure("There is no LOCAL storage to send", "rgbStringToSend");
        }
    }, function () {
        dialogAlert("You are currently not connected to any devices!");
    });
}

function sendSuccess() {
    console.log("[sendColor]", "SUCCESS");

}
function sendFailure(e) {
    console.log("[sendColor]", "failed!!", e);
}

function dialogAlert(displayMessage) {
    var message = displayMessage;
    var title = "ALERT";
    var buttonName = "Close";
    navigator.notification.alert(message, alertCallback, title, buttonName);
    
    function alertCallback() {
       console.log("[btEasy]","Alert is Dismissed!");
    }
  }